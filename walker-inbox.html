<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Walker Inbox – PetBnB (Demo)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
 <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body class="bg-light">
<div class="container py-4">
  <!--  (Demo) -->
  <h3 class="mb-3">Walker Inbox</h3> 
  <!-- <p class="text-muted">This is a demo page walkers can open to Accept / Reject bookings. It reads from localStorage.</p> -->

  <div id="inbox"></div>
</div>

<script>
  function getBookings(){ try{return JSON.parse(localStorage.getItem("bookings")||"[]");}catch{return[];} }
function setBookings(list){ localStorage.setItem("bookings", JSON.stringify(list)); }
function setBookingStatus(id, status){
  const list = getBookings();
  const idx = list.findIndex(b => b.id === id);
  if (idx >= 0) {
    list[idx].status = status;              // "confirmed" or "rejected"
    list[idx].updatedAt = Date.now();
    setBookings(list);
    // trigger cross-tab update for owner status modal
    localStorage.setItem("booking_status_" + id, status);
  }
}

function renderInbox(){
  const inbox = document.getElementById("inbox");
  inbox.innerHTML = "";
  const list = getBookings().filter(b => b.status === "pending"); // show only pending or show all if you like

  if (!list.length) {
    inbox.innerHTML = '<div class="alert alert-info">No pending requests.</div>';
    return;
  }

  list.forEach(b => {
    const card = document.createElement("div");
    card.className = "card mb-3";
    card.innerHTML = `
      <div class="card-body d-flex justify-content-between align-items-start">
        <div>
          <div class="fw-semibold">${b.ownerName} • ${b.phone}</div>
          <div class="small text-muted">Walker: ${b.walkerName}</div>
          <div class="small">When: ${b.slot} • Duration: ${b.duration} min</div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-danger btn-sm" data-reject="${b.id}">Reject</button>
          <button class="btn btn-success btn-sm" data-accept="${b.id}">Accept</button>
        </div>
      </div>
    `;
    inbox.appendChild(card);
  });

  // wire buttons
  inbox.querySelectorAll("[data-accept]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-accept");
      setBookingStatus(id, "confirmed"); // owner’s modal will update; owner then does payment
      renderInbox();
    });
  });
  inbox.querySelectorAll("[data-reject]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-reject");
      setBookingStatus(id, "rejected");
      renderInbox();
    });
  });
}

document.addEventListener("DOMContentLoaded", renderInbox);
</script>
</body>
</html>
